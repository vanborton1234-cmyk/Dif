<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المدرسة الإلكترونية - مشغل فيديو متطور</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #00ccff;
            --secondary-color: #007bff;
            --accent-color: #ff6b6b;
            --dark-bg: #0b0b0b;
            --header-bg: linear-gradient(135deg, #001f4d 0%, #003580 100%);
            --text-color: #fff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a1a1a 100%);
            color: var(--text-color);
            line-height: 1.8;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .auth-container {
            background: rgba(15, 15, 15, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        
        .auth-container h1 {
            color: var(--primary-color);
            font-size: 36px;
            margin-bottom: 20px;
        }
        
        .auth-container p {
            margin-bottom: 30px;
            font-size: 18px;
            color: #aaa;
        }
        
        .auth-form {
            margin-top: 20px;
        }
        
        .code-input {
            width: 100%;
            padding: 15px;
            font-size: 20px;
            text-align: center;
            border-radius: 10px;
            border: 2px solid var(--primary-color);
            background: #222;
            color: white;
            margin-bottom: 20px;
            letter-spacing: 2px;
        }
        
        .code-input:focus {
            outline: none;
            border-color: #00ffdd;
            box-shadow: 0 0 15px rgba(0, 204, 255, 0.6);
        }
        
        .auth-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .auth-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 123, 255, 0.6);
        }
        
        .error-message {
            color: #ff4757;
            margin-top: 15px;
            font-size: 16px;
            display: none;
        }
        
        .code-example {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 16px;
        }
        
        .code-example span {
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 25px;
            background: rgba(15, 15, 15, 0.9);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            display: none;
        }
        
        header {
            background: var(--header-bg);
            padding: 35px;
            text-align: center;
            border-radius: 18px;
            margin-bottom: 35px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--primary-color);
            position: relative;
        }
        
        header h1 {
            color: var(--primary-color);
            font-size: 42px;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0, 204, 255, 0.5);
        }
        
        .pledge {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-right: 5px solid var(--primary-color);
            font-size: 22px;
            line-height: 1.6;
            text-align: center;
        }
        
        .pledge i {
            color: var(--primary-color);
            margin-left: 10px;
        }
        
        .top-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .action-btn {
            display: inline-block;
            padding: 12px 25px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 14px;
            text-decoration: none;
            font-weight: bold;
            font-size: 18px;
            margin: 8px 5px;
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.4);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 123, 255, 0.6);
        }
        
        .video-player-container {
            position: relative;
            width: 100%;
            margin: 20px 0 40px 0;
        }
        
        .video-player {
            width: 100%;
            height: 600px;
            border-radius: 15px;
            border: none;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
            background: #000;
        }
        
        .video-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 12px 20px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: linear-gradient(45deg, #00ffdd, var(--primary-color));
            transform: translateY(-3px);
        }
        
        .time-display {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
            min-width: 100px;
            text-align: center;
        }
        
        .progress-container {
            flex-grow: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            position: relative;
            cursor: pointer;
        }
        
        .progress-bar {
            height: 100%;
            background: var(--primary-color);
            border-radius: 4px;
            width: 0%;
            transition: width 0.1s ease;
        }
        
        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .speed-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .speed-btn.active {
            background: var(--primary-color);
        }
        
        .quality-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .quality-btn {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .quality-btn.active {
            background: var(--primary-color);
        }
        
        .video-info-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            margin-top: 10px;
        }
        
        .video-title-display {
            font-size: 20px;
            color: var(--primary-color);
        }
        
        .video-stats {
            display: flex;
            gap: 15px;
            color: #aaa;
        }
        
        .video-stats span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .quick-player {
            background: linear-gradient(135deg, #111 0%, #222 100%);
            padding: 35px;
            border-radius: 18px;
            margin-bottom: 40px;
            border-left: 8px solid var(--primary-color);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        .quick-player h3 {
            margin-top: 0;
            font-size: 32px;
            color: var(--primary-color);
            margin-bottom: 25px;
            text-align: center;
        }
        
        input, select {
            width: 100%;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid var(--primary-color);
            background: #222;
            color: var(--text-color);
            margin-bottom: 20px;
            font-size: 20px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #00ffdd;
            box-shadow: 0 0 15px rgba(0, 204, 255, 0.6);
            background: #2a2a2a;
        }
        
        input::placeholder {
            color: #aaa;
        }
        
        button {
            padding: 18px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: bold;
            margin: 15px;
            transition: all 0.3s ease;
            font-size: 20px;
            box-shadow: 0 5px 15px rgba(0, 170, 255, 0.3);
        }
        
        button:hover {
            background: linear-gradient(45deg, #00ffdd, var(--primary-color));
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 204, 255, 0.5);
        }
        
        .floating-btn-container {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 1000;
        }
        
        .floating-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px 25px;
            background: linear-gradient(135deg, var(--accent-color), #ff8e8e);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
            transition: all 0.3s ease;
            font-weight: bold;
            gap: 10px;
            font-size: 18px;
        }
        
        .floating-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
        }
        
        .hidden {
            display: none;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--primary-color);
            font-size: 20px;
        }
        
        .loading i {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .container, .auth-container {
                padding: 15px;
            }
            
            header {
                padding: 25px;
            }
            
            header h1 {
                font-size: 32px;
            }
            
            .pledge {
                font-size: 18px;
                padding: 15px;
            }
            
            .video-player {
                height: 400px;
            }
            
            .video-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .progress-container {
                width: 100%;
            }
            
            .video-info-panel {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .floating-btn-container {
                bottom: 20px;
                left: 20px;
            }
            
            .floating-btn {
                padding: 12px 20px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- شاشة المصادقة -->
    <div class="auth-container" id="authContainer">
        <h1>المدرسة الإلكترونية</h1>
        <p>يرجى إدخال كود الدخول للوصول إلى المحتوى</p>
        
        <div class="auth-form">
            <input type="text" class="code-input" id="codeInput" placeholder="أدخل الكود المكون من 11 حرفًا" maxlength="11">
            <button class="auth-btn" id="authBtn">دخول</button>
            <div class="error-message" id="errorMessage">الكود غير صحيح، يرجى المحاولة مرة أخرى</div>
        </div>
        
        <div class="code-example">
            <p>الكود يجب أن يبدأ بـ <span>AB</span> وينتهي بـ <span>XY</span> مع 7 أرقام بينهما</p>
            <p>مثال: <span>AB1234567XY</span></p>
        </div>
    </div>

    <!-- المحتوى الرئيسي (سيظهر بعد المصادقة) -->
    <div class="container" id="mainContainer">
        <header>
            <h1>المدرسة الإلكترونية</h1>
            <div class="pledge">
                <i class="fas fa-hand-holding-heart"></i>
                أقسم بالله سأدرس اليوم ولن أسوّف في وقتي ، واذا خرجت من الموقع سأخرج لغرض مهم ثم أرجع لدراستي ، ولا أخرج من الفيديوا إلا لحالات الضرورة
            </div>
            
            <div class="top-buttons">
                <a class="action-btn" href="https://t.me/asssd_log" target="_blank">الامتحانات</a>
            </div>
        </header>

        <!-- مشغل الفيديو المتطور -->
        <div class="video-player-container">
            <div class="video-player" id="videoPlayer">
                <div style="display: flex; justify-content: center; align-items: center; height: 100%; background: #000; border-radius: 15px; flex-direction: column;">
                    <i class="fas fa-play-circle" style="font-size: 80px; color: var(--primary-color); margin-bottom: 20px;"></i>
                    <p style="color: #fff; font-size: 24px; text-align: center;">سيظهر الفيديو هنا بعد اختياره<br><span style="font-size: 18px; color: #aaa;">استخدم المشغل السريع أدناه لتشغيل فيديو</span></p>
                </div>
            </div>
            
            <div class="video-controls">
                <button class="control-btn" id="playPauseBtn" disabled>
                    <i class="fas fa-play"></i> تشغيل/إيقاف
                </button>
                
                <div class="time-display" id="timeDisplay">00:00 / 00:00</div>
                
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                
                <div class="speed-control">
                    <span>السرعة:</span>
                    <button class="speed-btn" data-speed="0.5">0.5x</button>
                    <button class="speed-btn active" data-speed="1">1x</button>
                    <button class="speed-btn" data-speed="1.5">1.5x</button>
                    <button class="speed-btn" data-speed="2">2x</button>
                </div>
                
                <div class="quality-control">
                    <span>الجودة:</span>
                    <button class="quality-btn active" data-quality="default">افتراضي</button>
                    <button class="quality-btn" data-quality="hd720">HD</button>
                    <button class="quality-btn" data-quality="hd1080">Full HD</button>
                </div>
            </div>
            
            <div class="video-info-panel">
                <div class="video-title-display" id="videoTitleDisplay">لم يتم اختيار فيديو</div>
                <div class="video-stats">
                    <span><i class="fas fa-eye"></i> <span id="viewCount">0</span></span>
                    <span><i class="fas fa-thumbs-up"></i> <span id="likeCount">0</span></span>
                    <span><i class="fas fa-calendar"></i> <span id="publishDate">--</span></span>
                </div>
            </div>
        </div>

        <div class="quick-player">
            <h3>تشغيل فيديو بسرعة</h3>
            <input id="quickLink" placeholder="ضع رابط الفيديو هنا">
            <div style="text-align: center;">
                <button id="quickPlayBtn">▶ تشغيل في المشغل المتطور</button>
            </div>
        </div>
    </div>

    <div class="floating-btn-container">
        <a href="https://t.me/likeflame5" target="_blank" class="floating-btn">
            <i class="fas fa-chalkboard-teacher"></i>
            <span>اسأل مدرس</span>
        </a>
    </div>

    <script>
        // نظام المصادقة
        const authContainer = document.getElementById('authContainer');
        const mainContainer = document.getElementById('mainContainer');
        const codeInput = document.getElementById('codeInput');
        const authBtn = document.getElementById('authBtn');
        const errorMessage = document.getElementById('errorMessage');
        
        // الكود المطلوب: يبدأ بـ AB وينتهي بـ XY وبينهما 7 أرقام
        const requiredStart = 'AB';
        const requiredEnd = 'XY';
        const codeLength = 11;
        
        // التحقق إذا كان المستخدم قد دخل من قبل
        function checkAuthentication() {
            const isAuthenticated = localStorage.getItem('isAuthenticated');
            if (isAuthenticated === 'true') {
                authContainer.style.display = 'none';
                mainContainer.style.display = 'block';
                return true;
            }
            return false;
        }
        
        // التحقق من صحة الكود
        function validateCode(code) {
            if (code.length !== codeLength) return false;
            if (!code.startsWith(requiredStart)) return false;
            if (!code.endsWith(requiredEnd)) return false;
            
            // التحقق من أن الأجزاء الوسطى هي أرقام
            const middlePart = code.substring(2, 9);
            return /^\d+$/.test(middlePart);
        }
        
        // معالجة عملية الدخول
        function handleAuthentication() {
            const code = codeInput.value.trim().toUpperCase();
            
            if (validateCode(code)) {
                // تخزين حالة المصادقة
                localStorage.setItem('isAuthenticated', 'true');
                
                // إخفاء شاشة المصادقة وإظهار المحتوى الرئيسي
                authContainer.style.display = 'none';
                mainContainer.style.display = 'block';
            } else {
                errorMessage.style.display = 'block';
                codeInput.value = '';
                codeInput.focus();
            }
        }
        
        // إضافة مستمعي الأحداث
        authBtn.addEventListener('click', handleAuthentication);
        
        codeInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleAuthentication();
            }
        });
        
        // التحقق من المصادقة عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkAuthentication()) {
                authContainer.style.display = 'block';
                mainContainer.style.display = 'none';
                codeInput.focus();
            }
        });

        // باقي كود المشغل (نفس الكود السابق)
        const videoPlayer = document.getElementById('videoPlayer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const timeDisplay = document.getElementById('timeDisplay');
        const progressBar = document.getElementById('progressBar');
        const progressContainer = document.getElementById('progressContainer');
        const speedBtns = document.querySelectorAll('.speed-btn');
        const qualityBtns = document.querySelectorAll('.quality-btn');
        const videoTitleDisplay = document.getElementById('videoTitleDisplay');
        const viewCount = document.getElementById('viewCount');
        const likeCount = document.getElementById('likeCount');
        const publishDate = document.getElementById('publishDate');
        const quickLinkInput = document.getElementById('quickLink');
        const quickPlayBtn = document.getElementById('quickPlayBtn');

        let currentVideo = null;
        let currentVideoId = null;
        let isPlaying = false;
        let currentTime = 0;
        let duration = 0;
        let playbackRate = 1;
        let currentQuality = 'default';

        // دالة محسنة لاستخراج معرف فيديو يوتيوب من أي نوع من الروابط
        function getYouTubeId(url) {
            if (!url) return null;
            
            // التعامل مع روابط youtube.com
            if (url.includes('youtube.com') || url.includes('youtu.be')) {
                const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
                const match = url.match(regExp);
                return (match && match[2].length === 11) ? match[2] : null;
            }
            
            // إذا كان الرابط يحتوي على 11 حرفاً (مثل معرف مباشر)
            if (url.length === 11 && !url.includes('/') && !url.includes('.')) {
                return url;
            }
            
            return null;
        }

        // تشغيل فيديو في المشغل المحسن
        function playVideo(link, quality = 'default', title = 'فيديو') {
            if (!link) return;
            
            const videoId = getYouTubeId(link);
            if (!videoId) {
                alert('رابط اليوتيوب غير صحيح');
                return;
            }
            
            currentVideoId = videoId;
            
            let embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&enablejsapi=1`;
            
            // إضافة معامل الجودة إذا تم اختيارها
            if (quality !== 'default') {
                embedUrl += `&vq=${quality}`;
            }
            
            // إضافة معلمات إضافية لتحسين الأداء
            embedUrl += '&rel=0&modestbranding=1&autohide=1&showinfo=0&controls=0';
            
            videoPlayer.innerHTML = `<iframe id="ytPlayer" src="${embedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
            
            // تحديث عنوان الفيديو
            videoTitleDisplay.textContent = title;
            
            // تمكين أزرار التحكم
            playPauseBtn.disabled = false;
            
            // تعيين المشغل الحالي
            currentVideo = document.getElementById('ytPlayer');
            
            // إضافة مستمعي الأحداث بعد تحميل الفيديو
            setTimeout(() => {
                if (currentVideo && currentVideo.contentWindow) {
                    // إرسال رسالة للتحقق من جاهزية الفيديو
                    currentVideo.contentWindow.postMessage('{"event":"listening","id":"ytPlayer"}', '*');
                }
            }, 2000);
            
            // الحصول على معلومات الفيديو من واجهة يوتيوب
            getVideoInfo(videoId);
            
            // التمرير إلى الفيديو
            videoPlayer.scrollIntoView({ behavior: 'smooth' });
        }

        // الحصول على معلومات الفيديو من يوتيوب
        function getVideoInfo(videoId) {
            // في بيئة حقيقية، يمكن استخدام YouTube Data API هنا
            // للتبسيط، سنستخدم بيانات وهمية
            viewCount.textContent = Math.floor(Math.random() * 10000).toLocaleString();
            likeCount.textContent = Math.floor(Math.random() * 1000).toLocaleString();
            
            // تاريخ النشر الوهمي
            const randomDate = new Date();
            randomDate.setDate(randomDate.getDate() - Math.floor(Math.random() * 365));
            publishDate.textContent = randomDate.toLocaleDateString('ar-SA');
        }

        // التحكم في التشغيل والإيقاف
        function togglePlayPause() {
            if (!currentVideo) return;
            
            if (isPlaying) {
                // إرسال أمر إيقاف إلى فيديو يوتيوب
                currentVideo.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i> تشغيل';
            } else {
                // إرسال أمر تشغيل إلى فيديو يوتيوب
                currentVideo.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i> إيقاف';
            }
            
            isPlaying = !isPlaying;
        }

        // تحديث عرض الوقت
        function updateTimeDisplay() {
            const currentMinutes = Math.floor(currentTime / 60);
            const currentSeconds = Math.floor(currentTime % 60);
            const durationMinutes = Math.floor(duration / 60);
            const durationSeconds = Math.floor(duration % 60);
            
            timeDisplay.textContent = 
                `${currentMinutes.toString().padStart(2, '0')}:${currentSeconds.toString().padStart(2, '0')} / ${durationMinutes.toString().padStart(2, '0')}:${durationSeconds.toString().padStart(2, '0')}`;
            
            // تحديث شريط التقدم
            if (duration > 0) {
                const progressPercent = (currentTime / duration) * 100;
                progressBar.style.width = `${progressPercent}%`;
            }
        }

        // تغيير سرعة التشغيل
        function changePlaybackRate(rate) {
            playbackRate = rate;
            
            // تحديث الأزرار النشطة
            speedBtns.forEach(btn => {
                if (parseFloat(btn.dataset.speed) === rate) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // إرسال أمر تغيير السرعة إلى فيديو يوتيوب
            if (currentVideo) {
                currentVideo.contentWindow.postMessage('{"event":"command","func":"setPlaybackRate","args":[' + rate + ']}', '*');
            }
        }

        // تغيير جودة الفيديو
        function changeVideoQuality(quality) {
            currentQuality = quality;
            
            // تحديث الأزرار النشطة
            qualityBtns.forEach(btn => {
                if (btn.dataset.quality === quality) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // إذا كان هناك فيديو يعمل، نعيد تشغيله بالجودة الجديدة
            if (currentVideoId) {
                const currentLink = quickLinkInput.value;
                if (currentLink) {
                    playVideo(currentLink, quality, videoTitleDisplay.textContent);
                }
            }
        }

        // النقر على شريط التقدم
        function setProgress(e) {
            if (!currentVideo || duration === 0) return;
            
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const percent = clickX / width;
            const newTime = percent * duration;
            
            // إرسال أمر الانتقال إلى الوقت المحدد
            currentVideo.contentWindow.postMessage('{"event":"command","func":"seekTo","args":[' + newTime + ', true]}', '*');
            
            // تحديث الوقت الحالي
            currentTime = newTime;
            updateTimeDisplay();
        }

        // تشغيل سريع
        quickPlayBtn.addEventListener('click', () => {
            const link = quickLinkInput.value.trim();
            if (!link) return;
            
            const videoId = getYouTubeId(link);
            if (!videoId) {
                alert('رابط اليوتيوب غير صحيح');
                return;
            }
            
            // استخدام المشغل المحسن
            playVideo(link, currentQuality, 'فيديو سريع');
        });

        // ربط الأحداث
        playPauseBtn.addEventListener('click', togglePlayPause);
        progressContainer.addEventListener('click', setProgress);

        // ربط أحداث أزرار السرعة
        speedBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                changePlaybackRate(parseFloat(btn.dataset.speed));
            });
        });

        // ربط أحداث أزرار الجودة
        qualityBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                changeVideoQuality(btn.dataset.quality);
            });
        });

        // استقبال رسائل من فيديو يوتيوب (للتحديثات)
        window.addEventListener('message', (event) => {
            // في تطبيق حقيقي، يمكن معالجة رسائل حالة الفيديو من يوتيوب هنا
            // للتبسيط، سنستخدم بيانات وهمية
        });

        // محاكاة تحديث الوقت والتقدم
        setInterval(() => {
            if (isPlaying && currentVideo && duration > 0) {
                currentTime += 1;
                
                if (currentTime >= duration) {
                    currentTime = 0;
                    isPlaying = false;
                    playPauseBtn.innerHTML = '<i class="fas fa-play"></i> تشغيل';
                }
                
                updateTimeDisplay();
            }
        }, 1000);

        // تهيئة التطبيق عند التحميل
        document.addEventListener('DOMContentLoaded', () => {
            // تعيين مدة فيديو وهمية
            duration = 360; // 6 دقائق
            updateTimeDisplay();
        });
    </script>
</body>
</html>
