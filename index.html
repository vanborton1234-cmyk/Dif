<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†ØµØ© ØªØ¬Ù„Ù‘ÙŠ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ - Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø¹Ù„Ù…ÙŠ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase Ø§Ù„Ø³Ù‡Ù„ -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCn9fVad2lA1_5AwRG6xC8lupndI2eYow4",
            authDomain: "project-e1da3.firebaseapp.com",
            projectId: "project-e1da3",
            storageBucket: "project-e1da3.firebasestorage.app",
            messagingSenderId: "560086523718",
            appId: "1:560086523718:web:b1f980c44fe69bf12b4f47"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        console.log("Firebase connected!");
    </script>

    <style>
        :root {
            --primary-color: #00ccff;
            --secondary-color: #007bff;
            --accent-color: #ff6b6b;
            --dark-bg: #0b0b0b;
            --text-color: #fff;
        }

        [data-theme="light"] {
            --primary-color: #007bff;
            --dark-bg: #f8f9fa;
            --text-color: #333;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: var(--dark-bg);
            color: var(--text-color);
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(15, 15, 15, 0.95);
            padding: 20px;
            border-radius: 15px;
        }

        [data-theme="light"] .container {
            background: rgba(255, 255, 255, 0.95);
        }
        
        header {
            background: linear-gradient(135deg, #001f4d, #003580);
            padding: 25px;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 2px solid var(--primary-color);
        }
        
        .theme-toggle {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            color: white;
            font-size: 20px;
        }
        
        header h1 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .top-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .action-btn {
            padding: 10px 20px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.4);
        }
        
        .quick-player, .video-section {
            background: rgba(30, 30, 30, 0.9);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid var(--primary-color);
        }

        [data-theme="light"] .quick-player,
        [data-theme="light"] .video-section {
            background: rgba(240, 240, 240, 0.9);
        }
        
        input, select, button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            border: 2px solid var(--primary-color);
            background: #222;
            color: var(--text-color);
            font-size: 16px;
        }

        [data-theme="light"] input,
        [data-theme="light"] select {
            background: white;
            color: #333;
        }
        
        button {
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #00aaff;
            transform: translateY(-2px);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .card {
            background: linear-gradient(135deg, #007bff, #00aaff);
            color: white;
            padding: 30px 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.3rem;
            transition: all 0.3s;
            border: 2px solid rgba(255,255,255,0.1);
        }
        
        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 123, 255, 0.5);
        }
        
        .hidden {
            display: none;
        }
        
        #videoContainer {
            position: relative;
            margin: 20px 0;
        }
        
        #videoContainer iframe {
            width: 100%;
            height: 400px;
            border-radius: 10px;
            border: none;
        }

        /* Ø¹Ù†Ø§ØµØ± ØªØ­ÙƒÙ… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        .video-controls {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        
        .control-btn {
            padding: 10px 15px;
            background: #333;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .control-btn:hover {
            background: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .speed-controls {
            display: flex;
            gap: 5px;
        }
        
        .speed-btn {
            padding: 8px 12px;
            background: #444;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .speed-btn.active {
            background: #00ff88;
            color: #000;
        }

        /* ÙˆØ¶Ø¹ Ù‚ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø© */
        .screen-lock {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        .screen-lock.active {
            display: flex;
        }
        
        .lock-video {
            width: 90%;
            height: 70%;
        }
        
        .lock-video iframe {
            width: 100%;
            height: 100%;
            border-radius: 10px;
        }
        
        .unlock-btn {
            margin-top: 20px;
            padding: 15px 30px;
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }
        
        .video-item {
            background: rgba(40, 40, 40, 0.9);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid var(--primary-color);
        }

        [data-theme="light"] .video-item {
            background: rgba(220, 220, 220, 0.9);
        }
        
        .video-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .video-actions button {
            flex: 1;
            padding: 8px;
            font-size: 14px;
        }
        
        .back-button {
            background: #666;
            margin-top: 20px;
        }
        
        .back-button:hover {
            background: #888;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            #videoContainer iframe {
                height: 300px;
            }
            
            .video-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>

<!-- ÙˆØ¶Ø¹ Ù‚ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø© -->
<div class="screen-lock" id="screenLock">
    <div class="lock-video" id="lockVideo">
        <!-- Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØ¶Ø§Ù Ù‡Ù†Ø§ -->
    </div>
    <button class="unlock-btn" onclick="unlockScreen()">
        <i class="fas fa-unlock"></i> ÙØªØ­ Ø§Ù„Ø´Ø§Ø´Ø©
    </button>
</div>

<div class="container">
    <header>
        <button class="theme-toggle" id="themeToggle">
            <i class="fas fa-moon"></i>
        </button>
        
        <h1>Ù…Ù†ØµØ© ØªØ¬Ù„Ù‘ÙŠ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ - Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø¹Ù„Ù…ÙŠ</h1>
        <p>ØªÙ… ØªØµÙ…ÙŠÙ… Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø·Ù„Ù‘Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¯Ø³</p>
        
        <div class="top-buttons">
            <a class="action-btn" href="https://t.me/N7BBOT" target="_blank">ğŸš€ Ø§Ù†Ø¶Ù… Ù„Ù„ØªØ­Ø¯ÙŠ</a>
            <a class="action-btn" href="https://t.me/asssd_log" target="_blank">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</a>
            <a class="action-btn" href="https://t.me/manasaate" target="_blank">ğŸ“º Ù‚Ù†Ø§Ø© Ø§Ù„ØªØ­Ø¯ÙŠ</a>
            <button class="action-btn" onclick="showLocalSaves()">ğŸ“ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</button>
        </div>
    </header>

    <div class="quick-player">
        <h3>ØªØ´ØºÙŠÙ„ ÙÙŠØ¯ÙŠÙˆ Ø¨Ø³Ø±Ø¹Ø©</h3>
        <input id="quickLink" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù‡Ù†Ø§">
        <button id="quickPlayBtn">â–¶ ØªØ´ØºÙŠÙ„ Ø³Ø±ÙŠØ¹</button>
        <button id="quickSaveBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø·</button>
        <div id="quickContainer"></div>
    </div>

    <h2>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©</h2>
    <div id="subjects" class="grid">
        <div class="loading">
            <i class="fas fa-spinner"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯...
        </div>
    </div>

    <div id="chaptersPage" class="hidden">
        <h3 id="subjectTitle"></h3>
        <div id="chapters" class="grid">
            <div class="loading">
                <i class="fas fa-spinner"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØµÙˆÙ„...
            </div>
        </div>
        <button class="back-button" onclick="backToSubjects()">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆØ§Ø¯</button>
    </div>

    <div id="linksPage" class="hidden">
        <h3 id="chapterTitle"></h3>
        
        <div class="video-section">
            <input id="lectureName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©">
            <input id="topicName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹">
            <input id="lectureLink" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨">
            <button id="saveBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø©</button>
            <button id="playNewBtn">â–¶ ØªØ´ØºÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±</button>
        </div>
        
        <div id="playlistContainer">
            <div class="loading" id="loadingIndicator">
                <i class="fas fa-spinner"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª...
            </div>
            <div id="savedLinks"></div>
        </div>
        
        <div id="videoContainer">
            <!-- Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙˆØ¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… ØªØ¶Ø§Ù Ù‡Ù†Ø§ -->
        </div>
        
        <button class="back-button" onclick="backToChapters()">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙØµÙˆÙ„</button>
    </div>
    
    <div id="localSavesPage" class="hidden">
        <h2>Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹</h2>
        <div id="localSavesList">
            <div class="loading">
                <i class="fas fa-spinner"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©...
            </div>
        </div>
        <button class="back-button" onclick="backToMain()">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>
</div>

<script>
// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„ÙØµÙˆÙ„
const subjectsData = {
    "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª": ["Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©", "Ø§Ù„Ù‚Ø·ÙˆØ¹ Ø§Ù„Ù…Ø®Ø±ÙˆØ·ÙŠØ©", "ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„ØªÙØ§Ø¶Ù„", "Ø§Ù„ØªÙƒØ§Ù…Ù„", "Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„ØªÙØ§Ø¶Ù„ÙŠØ© Ø§Ù„Ø§Ø¹ØªÙŠØ§Ø¯ÙŠØ©", "Ø§Ù„Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ©"],
    "Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡": ["Ø§Ù„Ù…ØªØ³Ø¹Ø§Øª", "Ø§Ù„Ø­Ø« Ø§Ù„ÙƒÙ‡Ø±ÙˆÙ…ØºÙ†Ø§Ø·ÙŠØ³ÙŠ", "Ø§Ù„ØªÙŠØ§Ø± Ø§Ù„Ù…ØªÙ†Ø§ÙˆØ¨", "Ø§Ù„Ù…ÙˆØ¬Ø§Øª Ø§Ù„ÙƒÙ‡Ø±ÙˆÙ…ØºÙ†Ø§Ø·ÙŠØ³ÙŠØ©", "Ø§Ù„Ø¨ØµØ±ÙŠØ§Øª Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©", "Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ø­Ø¯ÙŠØ«Ø©", "Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµÙ„Ø¨Ø©", "Ø§Ù„Ø£Ø·ÙŠØ§Ù Ø§Ù„Ø°Ø±ÙŠØ© ÙˆØ§Ù„Ù„ÙŠØ²Ø±", "Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ù†ÙˆÙˆÙŠØ©"],
    "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡": ["Ø§Ù„Ø«Ø±Ù…ÙˆØ¯Ø§ÙŠÙ†Ù…Ùƒ", "Ø§Ù„Ø§ØªØ²Ø§Ù† Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ", "Ø§Ù„Ø§ØªØ²Ø§Ù† Ø§Ù„Ø£ÙŠÙˆÙ†ÙŠ", "ØªÙØ§Ø¹Ù„Ø§Øª Ø§Ù„ØªØ£ÙƒØ³Ø¯ ÙˆØ§Ù„Ø§Ø®ØªØ²Ø§Ù„ ÙˆØ§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©", "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„ØªÙ†Ø§Ø³Ù‚ÙŠØ©", "Ø·Ø±Ø§Ø¦Ù‚ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠ", "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© Ù„Ù„Ù‡ÙŠØ¯Ø±ÙˆÙƒØ±Ø¨ÙˆÙ†Ø§Øª Ø§Ù„Ù…Ø¹ÙˆØ¶Ø©", "Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ø­ÙŠØ§ØªÙŠØ©"],
    "Ø§Ù„Ø£Ø­ÙŠØ§Ø¡": ["Ø§Ù„Ø®Ù„ÙŠØ©", "Ø§Ù„Ø£Ù†Ø³Ø¬Ø©", "Ø§Ù„ØªÙƒØ§Ø«Ø±", "Ø§Ù„ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø¬Ù†ÙŠÙ†ÙŠ", "Ø§Ù„ÙˆØ±Ø§Ø«Ø©"],
    "Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©": ["Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰", "Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©", "Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©", "Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©", "Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø®Ø§Ù…Ø³Ø©"],
    "Ø§Ù„Ø¹Ø±Ø¨ÙŠ": ["Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰", "Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©"],
    "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©": ["Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰", "Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©", "Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©", "Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©", "Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø®Ø§Ù…Ø³Ø©", "Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø³Ø§Ø¯Ø³Ø©", "Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø³Ø§Ø¨Ø¹Ø©", "Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù…Ù†Ø©"]
};

// Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙÙŠ DOM
const elements = {
    subjects: document.getElementById('subjects'),
    chaptersPage: document.getElementById('chaptersPage'),
    linksPage: document.getElementById('linksPage'),
    localSavesPage: document.getElementById('localSavesPage'),
    chapters: document.getElementById('chapters'),
    subjectTitle: document.getElementById('subjectTitle'),
    chapterTitle: document.getElementById('chapterTitle'),
    savedLinks: document.getElementById('savedLinks'),
    videoContainer: document.getElementById('videoContainer'),
    themeToggle: document.getElementById('themeToggle'),
    screenLock: document.getElementById('screenLock'),
    lockVideo: document.getElementById('lockVideo')
};

let currentSubject = "", currentChapter = "";
let currentVideoUrl = "";

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø«ÙŠÙ…
function initTheme() {
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme);
    updateThemeIcon(savedTheme);
}

function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    updateThemeIcon(newTheme);
}

function updateThemeIcon(theme) {
    const icon = elements.themeToggle.querySelector('i');
    icon.className = theme === 'dark' ? 'fas fa-moon' : 'fas fa-sun';
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¯
function renderSubjects() {
    let html = '';
    Object.keys(subjectsData).forEach(sub => {
        html += `<div class="card" onclick="openSubject('${sub}')">${sub}</div>`;
    });
    elements.subjects.innerHTML = html;
}

function openSubject(subject) {
    currentSubject = subject;
    elements.subjectTitle.textContent = `Ø§Ù„Ù…Ø§Ø¯Ø©: ${subject}`;
    
    let html = '';
    subjectsData[subject].forEach(chapter => {
        html += `<div class="card" onclick="openChapter('${chapter}')">${chapter}</div>`;
    });
    elements.chapters.innerHTML = html;
    
    elements.subjects.classList.add('hidden');
    elements.chaptersPage.classList.remove('hidden');
}

function openChapter(chapter) {
    currentChapter = chapter;
    elements.chapterTitle.textContent = `${currentSubject} - ${chapter}`;
    loadLectures();
    
    elements.chaptersPage.classList.add('hidden');
    elements.linksPage.classList.remove('hidden');
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù…Ù† Firebase
function loadLectures() {
    elements.savedLinks.innerHTML = '<div class="loading"><i class="fas fa-spinner"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª...</div>';
    
    db.collection('lectures')
        .where('subject', '==', currentSubject)
        .where('chapter', '==', currentChapter)
        .orderBy('timestamp', 'desc')
        .get()
        .then(snapshot => {
            if (snapshot.empty) {
                elements.savedLinks.innerHTML = '<p style="text-align: center; padding: 20px; color: #aaa;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø­Ø§Ø¶Ø±Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙØµÙ„</p>';
                return;
            }
            
            let html = '';
            snapshot.forEach(doc => {
                const data = doc.data();
                html += `
                    <div class="video-item">
                        <strong>${data.name}</strong> - ${data.topic}
                        <div class="video-actions">
                            <button onclick="playVideo('${data.link}')">â–¶ ØªØ´ØºÙŠÙ„</button>
                            <button onclick="deleteLecture('${doc.id}')">ğŸ—‘ Ø­Ø°Ù</button>
                        </div>
                    </div>
                `;
            });
            elements.savedLinks.innerHTML = html;
        })
        .catch(error => {
            console.error('Error loading lectures:', error);
            elements.savedLinks.innerHTML = '<p style="text-align: center; color: #ff6b6b; padding: 20px;">Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø§Øª</p>';
        });
}

// Ø­ÙØ¸ Ù…Ø­Ø§Ø¶Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©
document.getElementById('saveBtn').addEventListener('click', async () => {
    const name = document.getElementById('lectureName').value.trim();
    const topic = document.getElementById('topicName').value.trim();
    const link = document.getElementById('lectureLink').value.trim();
    
    if (!name || !topic || !link) {
        alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
        return;
    }
    
    if (!getYouTubeId(link)) {
        alert('Ø±Ø§Ø¨Ø· Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ ØºÙŠØ± ØµØ­ÙŠØ­');
        return;
    }
    
    try {
        await db.collection('lectures').add({
            subject: currentSubject,
            chapter: currentChapter,
            name: name,
            topic: topic,
            link: link,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            createdBy: 'public'
        });
        
        alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¶Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!');
        document.getElementById('lectureName').value = '';
        document.getElementById('topicName').value = '';
        document.getElementById('lectureLink').value = '';
        loadLectures();
    } catch (error) {
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: ' + error.message);
    }
});

// Ø­Ø°Ù Ù…Ø­Ø§Ø¶Ø±Ø©
async function deleteLecture(id) {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) {
        try {
            await db.collection('lectures').doc(id).delete();
            loadLectures();
        } catch (error) {
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù');
        }
    }
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
function playVideo(link) {
    const videoId = getYouTubeId(link);
    if (!videoId) {
        alert('Ø±Ø§Ø¨Ø· Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨ ØºÙŠØ± ØµØ­ÙŠØ­');
        return;
    }
    
    currentVideoUrl = link;
    const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1`;
    
    elements.videoContainer.innerHTML = `
        <iframe src="${embedUrl}" frameborder="0" allowfullscreen></iframe>
        <div class="video-controls">
            <div class="speed-controls">
                <button class="speed-btn" onclick="changeSpeed(0.5)">0.5x</button>
                <button class="speed-btn active" onclick="changeSpeed(1)">1x</button>
                <button class="speed-btn" onclick="changeSpeed(1.5)">1.5x</button>
                <button class="speed-btn" onclick="changeSpeed(2)">2x</button>
                <button class="speed-btn" onclick="changeSpeed(3)">3x</button>
                <button class="speed-btn" onclick="changeSpeed(4)">4x</button>
            </div>
            <button class="control-btn" onclick="seekVideo(-10)">âª -10s</button>
            <button class="control-btn" onclick="seekVideo(10)">â© +10s</button>
            <button class="control-btn" onclick="lockScreen()">ğŸ”’ Ù‚ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©</button>
        </div>
    `;
}

// Ù…ÙŠØ²Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
function changeSpeed(speed) {
    document.querySelectorAll('.speed-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ YouTube API Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ø±Ø¹Ø©
    alert(`ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø³Ø±Ø¹Ø© Ø¥Ù„Ù‰ ${speed}x (Ù‡Ø°Ù‡ Ù…ÙŠØ²Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©)`);
}

function seekVideo(seconds) {
    alert(`ØªÙ… Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… ${seconds > 0 ? '+' : ''}${seconds} Ø«Ø§Ù†ÙŠØ© (Ù‡Ø°Ù‡ Ù…ÙŠØ²Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©)`);
}

function lockScreen() {
    if (!currentVideoUrl) return;
    
    const videoId = getYouTubeId(currentVideoUrl);
    elements.lockVideo.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1" frameborder="0" allowfullscreen></iframe>`;
    elements.screenLock.classList.add('active');
}

function unlockScreen() {
    elements.screenLock.classList.remove('active');
    elements.lockVideo.innerHTML = '';
}

// ØªØ´ØºÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±
document.getElementById('playNewBtn').addEventListener('click', () => {
    const link = document.getElementById('lectureLink').value.trim();
    if (link) playVideo(link);
});

// ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø©
function getYouTubeId(url) {
    const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
    const match = url.match(regExp);
    return (match && match[2].length === 11) ? match[2] : null;
}

function backToSubjects() {
    elements.chaptersPage.classList.add('hidden');
    elements.subjects.classList.remove('hidden');
}

function backToChapters() {
    elements.linksPage.classList.add('hidden');
    elements.chaptersPage.classList.remove('hidden');
}

function backToMain() {
    elements.localSavesPage.classList.add('hidden');
    elements.subjects.classList.remove('hidden');
}

function showLocalSaves() {
    elements.subjects.classList.add('hidden');
    elements.localSavesPage.classList.remove('hidden');
    loadLocalSaves();
}

function loadLocalSaves() {
    const saves = JSON.parse(localStorage.getItem('quickSaves') || '[]');
    let html = '';
    
    saves.forEach((save, index) => {
        html += `
            <div class="video-item">
                ${save.link}
                <div class="video-actions">
                    <button onclick="playVideo('${save.link}')">â–¶ ØªØ´ØºÙŠÙ„</button>
                    <button onclick="deleteLocalSave(${index})">ğŸ—‘ Ø­Ø°Ù</button>
                </div>
            </div>
        `;
    });
    
    elements.localSavesList.innerHTML = html || '<p style="text-align: center; padding: 20px; color: #aaa;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ÙˆØ§Ø¨Ø· Ù…Ø­ÙÙˆØ¸Ø©</p>';
}

function deleteLocalSave(index) {
    const saves = JSON.parse(localStorage.getItem('quickSaves') || '[]');
    saves.splice(index, 1);
    localStorage.setItem('quickSaves', JSON.stringify(saves));
    loadLocalSaves();
}

// Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹
document.getElementById('quickPlayBtn').addEventListener('click', () => {
    const link = document.getElementById('quickLink').value.trim();
    if (link) playVideo(link);
});

document.getElementById('quickSaveBtn').addEventListener('click', () => {
    const link = document.getElementById('quickLink').value.trim();
    if (!link) return alert('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø£ÙˆÙ„Ø§Ù‹');
    
    const saves = JSON.parse(localStorage.getItem('quickSaves') || '[]');
    saves.push({ link: link, timestamp: Date.now() });
    localStorage.setItem('quickSaves', JSON.stringify(saves));
    alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø­Ù„ÙŠØ§Ù‹!');
});

// Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
document.addEventListener('DOMContentLoaded', () => {
    initTheme();
    renderSubjects();
    elements.themeToggle.addEventListener('click', toggleTheme);
});
</script>
</body>
</html>
